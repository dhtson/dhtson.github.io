---
title: "Misc / Farewell Gift - DDC 2025"
excerpt: "A writeup on the Misc / Farewell Gift challenge from DDC 2025"
category:
  - "CTF"
  - "Writeups"
tags:
  - "CTF"
  - "Misc"
  - "Machine Learning"
  - "TensorFlow"
  - "2025"
languages:
    - vi
authors:
    - "harshfeudal"
---

***Farewell Gift***

*500*

*Droplet*

*Daenerys, the lead machine learning engineer at DAD Corporation, has resigned following a conflict with the CEO over the company's direction. As a parting gesture, she left the model she was working on as a "farewell gift". The sample results appear good, but we suspect that something suspicious is going on with this model. Can you find out what it is?*

*Hint 1: Look carefully at the model layers and their attributes*

*Hint 2: This is a fine-tuned model; finding the original model will help (2:00AM hint lmao)*

Ok th√¨ b√†i n√†y m√¨nh th·∫•y n√≥ na n√° v·ªõi HTB Apocalypse m√¨nh ƒë√£ t·ª´ng ch∆°i n√™n m√¨nh ƒë√£ c·ªë g·∫Øng gi·∫£i n√≥, nh∆∞ng m√† do th·ª© 7 m√¨nh c√≥ vi·ªác n√™n v·ªÅ kh√° tr·ªÖ, h·∫ßu nh∆∞ kh√¥ng gi√∫p ƒë∆∞·ª£c cho team nhi·ªÅu n√™n l√† team m√¨nh kh√¥ng th·ªÉ solve ƒë∆∞·ª£c n√≥ (·ªù m·∫•y b·∫°n b·∫£o l√Ω do n√†y n·ªç th√¨ c≈©ng ch·ªãu).

Th√¨ do ƒë√£ c√≥ kinh nghi·ªám n√™n m√¨nh ƒë√£ bi·∫øt m·ªôt b√†i CTF ML v·∫≠n h√†nh th·∫ø n√†o r·ªìi. ƒêi·ªÅu ƒë·∫ßu ti√™n m√¨nh l√†m l√† s·∫Ω summary model ƒë√≥:

```python
import tensorflow as tf
from tensorflow import keras

model = keras.models.load_model('models/dad-vision-final.keras')

model.summary()
```

G√µ `python run.py > summary.txt` th√¨ n√≥ s·∫Ω ra m·ªôt c√°i list ƒë√∫ng d√†i. Nh∆∞ng n·∫øu ai c√≥ h·ªçc qua 1 l·ªõp AI tr√™n tr∆∞·ªùng ho·∫∑c t·ª± h·ªçc c·ªßa Andrew Ng th√¨ c≈©ng nh·∫≠n ra ƒë√¢y l√† EfficientNetV2. Sao m√¨nh bi·∫øt? Do c√°ch ƒë·∫∑t t√™n:

```
block<number><letter>_<operation>
```

V·ªõi l·∫°i n·∫øu kh√¥ng bi·∫øt th√¨ c·ª© b·ªè v√†o Gia Ph√°t Th·ªãnh (GPT) h·ªèi n√≥ l√† ‚Äútao ƒëang l√†m t·ªõi ƒë√¢y r·ªìi th√¨ m√¥ h√¨nh n√†y gi·ªëng m√¥ h√¨nh g√¨?‚Äù th√¨ n√≥ s·∫Ω tr·∫£ l·ªùi ngay :D

Th√¨ n·∫øu t√¨m ra EfficientNetV2 r·ªìi th√¨ ·ªü ƒë√¢y c√°i clue m√¨nh kh√¥ng gi·∫£i ra ƒë∆∞·ª£c l√† g√¨?

![image.png](image.png)

Ye m√¨nh ƒë√£ bi·∫øt n√≥ l√† EfficientNetV2 r·ªìi nh∆∞ng v·∫´n kh√¥ng bi·∫øt sao nh√©t flag ra, lmao. M√¨nh ng·ªìi ƒë·ªçc m·∫•y c√°i writeup c·ªßa HTB Apocalypse c≈© th√¨ m√¨nh ch·ª£t nh·∫≠n ra kh√° √≠t ng∆∞·ªùi vi·∫øt writeup n√†y. Nh∆∞ng m√† ch·∫Øc do t·ªëi r·ªìi n√™n m√¨nh kh√¥ng t·ªânh t√°o. Th√¥i s√°ng mai d·∫≠y l√†m ti·∫øp.

Lmao s√°ng d·∫≠y mu·ªôn, 10h m·ªõi d·∫≠y üíÄ

N√≥i chung event k·∫øt th√∫c th√¨ c≈©ng k·ªá, l√†m l·∫•y kinh nghi·ªám. 

M√¨nh ch·ª£t nh·ªõ ra l√†: n·∫øu ƒë√£ l√† CTF th√¨ ng∆∞·ªùi ta ph·∫£i thay ƒë·ªïi c·∫•u tr√∫c n√≥, ƒë√∫ng kh√¥ng? M√¨nh h·ªèi Gia Ph√°t Th·ªãnh l√† ‚Äú√† tao mu·ªën bi·∫øt l√†m sao ƒë·ªÉ tao compare gi·ªØa c√°i EfficientNetV2 g·ªëc v·ªõi c√°i n√†y?‚Äù th√¨ n√≥ cho m√¨nh c√°i th∆∞ vi·ªán n√†y:

```python
from tensorflow.keras.applications import EfficientNetV2S
```

Kh√¥ng ph·∫£i ch·ªù ƒë·ª£i, t√¥i s·ª≠ d·ª•ng t√≠nh nƒÉng Vibe-Coding m√¨nh hi·ªán c√≥:

```python
import numpy as np
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras.applications import EfficientNetV2S

model = keras.models.load_model('models/dad-vision-final.keras')
original_model = EfficientNetV2S(weights='imagenet')
modified_layer_name = None

for dad_layer, original_layer in zip(model.layers, original_model.layers):
    dad_weights = dad_layer.get_weights()
    original_weights = original_layer.get_weights()

    if dad_weights and original_weights:
        for i in range(len(dad_weights)):
            if not np.array_equal(dad_weights[i], original_weights[i]):
                modified_layer_name = dad_layer.name
                print(f"Found modified weights in layer: '{modified_layer_name}'")
                break
    if modified_layer_name:
        break

if not modified_layer_name:
    print("No modified layers found.")
```

Th√¨ console b√°o:

```
Found modified weights in layer: 'block5i_se_reduce'
```

Ye, th·∫ø l√† m√¨nh c√≥ clue ti·∫øp.

N·∫øu ai h·ªçc AI r·ªìi th√¨ s·∫Ω bi·∫øt r·∫±ng trong m·ªôt model, ng∆∞·ªùi ta s·∫Ω c√≥ Weight v·ªõi Bias. ·ªû ƒë√¢y th√¨ m√¨nh b·∫Øt ƒë·∫ßu xu·∫•t c·∫£ hai ra:

```python
modified_layer = model.get_layer(modified_layer_name)

weights = modified_layer.get_weights()
print(f"Weights: {weights}")

bias_vector = weights[1]
print(f"Bias Vector: {bias_vector}")
```

Th√¨ console b√°o:

```
Weights: [array([[[[-0.04686987,  0.0215106 ,  0.01236106, ...,  0.03371817,
           0.03543964, -0.00289477],
         [-0.0655726 , -0.04068068, -0.09533687, ..., -0.00772091,
          -0.08749958, -0.08933775],
         [ 0.02095766,  0.00260389,  0.02771965, ...,  0.00584774,
          -0.00793114,  0.03512393],
         ...,
         [-0.00499907, -0.01449113,  0.05294973, ...,  0.00270706,
           0.0440886 ,  0.0304351 ],
         [ 0.03093076, -0.02054276, -0.00243449, ..., -0.03394082,
          -0.01244923, -0.00475881],
         [ 0.02237011,  0.05259237, -0.04361826, ...,  0.05828479,
          -0.01201546,  0.01032932]]]],
      shape=(1, 1, 960, 40), dtype=float32), array([0.0068, 0.0068, 0.0067, 0.0123, 0.0121, 0.0111, 0.0085, 0.0095,
       0.007 , 0.0111, 0.0117, 0.011 , 0.0068, 0.0095, 0.0077, 0.0121,
       0.0095, 0.0104, 0.0049, 0.0068, 0.0068, 0.0101, 0.0078, 0.0095,
       0.0053, 0.0073, 0.0103, 0.011 , 0.0065, 0.0116, 0.0117, 0.0082,
       0.0101, 0.0095, 0.004 , 0.0094, 0.0111, 0.0094, 0.0041, 0.0125],
      dtype=float32)]
Bias Vector: [0.0068 0.0068 0.0067 0.0123 0.0121 0.0111 0.0085 0.0095 0.007  0.0111
 0.0117 0.011  0.0068 0.0095 0.0077 0.0121 0.0095 0.0104 0.0049 0.0068
 0.0068 0.0101 0.0078 0.0095 0.0053 0.0073 0.0103 0.011  0.0065 0.0116
 0.0117 0.0082 0.0101 0.0095 0.004  0.0094 0.0111 0.0094 0.0041 0.0125]
```

·ªû ƒë√¢y, m√¨nh th·∫•y l√† Bias Vector ‚Äúkh√°‚Äù l√† √≠t gi√° tr·ªã, v√† c√°c gi√° tr·ªã ƒë·ªÅu r·∫•t l√† l·∫° l√† l√†m tr√≤n c·ª° 3-4 ch·ªØ s·ªë, kh√¥ng nh∆∞ Weight. N√™n m√¨nh h∆°i nghi, n·∫øu nh∆∞ nh√¢n v·ªõi 10.000 th√¨ n√≥ th√†nh s·ªë c√≥ 2 v·ªõi 3 ch·ªØ s·ªë v√† kh√¥ng qu√° l·ªõn (b·∫£ng ASCII ƒë·∫•y ae ∆°i). N√™n l√†:

```python
flag = ""
for value in bias_vector:
    char_code = int(round(value * 10000.0))
    
    if 32 <= char_code <= 126:
        flag += chr(char_code)

print(flag)
```

V√† k·∫øt qu·∫£ l√†:

```
DDC{yoU_FounD_My_h1DDeN_5IgnAtuRe_(^o^)}
```

## L·ªùi k·∫øt

:D

Anyways, b√†i oke, Waguri/10

<img src="cc97ddd6-1d5c-4641-a59c-5fb92dc11a7f.png" alt="image.png" style="width: 30%; height: auto;" />
